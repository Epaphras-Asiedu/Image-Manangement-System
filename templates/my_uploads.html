{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='frontend/my_uploads.css') }}">

<div class="uploads-container">
    <h2 class="uploads-title">ğŸ“‚ My Uploads</h2>

    {% if images %}
    <div class="uploads-grid">
        {% for img in images %}
        <div class="upload-card">
            <img src="{{ url_for('static', filename='uploads/' ~ img.filename) }}" alt="{{ img.title }}" class="upload-thumbnail">
            <div class="upload-info">
                <b>{{ img.title }}</b> <span class="category">({{ img.category }})</span><br>
                <small>Tags: {{ img.tags }}</small><br>
                    <small>
                        Visibility:
                        {% if img.visibility == 'public' %}
                            <span style="color:#43e97b; font-weight:600;">
                                ğŸŒ Public
                            </span>
                        {% else %}
                            <span style="color:#fc5c7d; font-weight:600;">
                                ğŸ”’ Private
                            </span>
                        {% endif %}
                        <button class="btn toggle-visibility" data-id="{{ img.id }}" data-current="{{ img.visibility }}" title="Toggle visibility">
                            <i class="fa-solid fa-arrows-rotate"></i>
                        </button>
                    </small><br>
            </div>
            <a class="btn view-btn" href="{{ url_for('images.upload_done', image_id=img.id) }}">ğŸ‘ View</a>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <p class="no-uploads"> You haven't uploaded any images yet.</p>
    {% endif %}
</div>
<script>
document.querySelectorAll('.toggle-visibility').forEach(btn => {
    btn.onclick = function() {
        const imageId = this.getAttribute('data-id');
        const current = this.getAttribute('data-current');
        const newVis = current === 'public' ? 'private' : 'public';
        if (confirm(`Change visibility to ${newVis.toUpperCase()}?`)) {
            fetch(`/toggle_visibility/${imageId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ visibility: newVis })
            }).then(res => {
                if (res.ok) location.reload();
                else alert('Failed to change visibility.');
            });
        }
    };
});
</script>
{% endblock %}
